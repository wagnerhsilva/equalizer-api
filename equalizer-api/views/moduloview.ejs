<!DOCTYPE html>
<html ng-app="app">

<head>
    <% include partials/head %>
    <style>
        .displayNone{display: none !important;}
        .checkboxes label {
            display: block;
            float: left;
            padding-right: 10px;
            white-space: nowrap;
        }
        .checkboxes input {
            vertical-align: middle;
        }
        .checkboxes label span {
            vertical-align: middle;
        }
    </style>
</head>

<body class="">
    <% include partials/header %>
        <div id="main" role="main">

            <!-- RIBBON -->
            <div id="ribbon">

                <!-- breadcrumb -->
                <ol class="breadcrumb">
                    <li><%= translate.config %></li>
                    <li><%= translate.modules %></li>
                </ol>
            </div>
            <div id="content">
                <div class="row">
                    <article class="col-sm-12 col-md-12 col-lg-12">

                        <!-- Widget ID (each widget will need unique ID)-->
                        <div class="jarviswidget" id="wid-id-4" data-widget-editbutton="false" data-widget-custombutton="false">
                            <header>
                                <span class="widget-icon"><i class="fa fa-edit"></i></span>
                                <h2><%= translate.modules %></h2>

                            </header>

                            <!-- widget div-->
                            <div>

                                <!-- widget edit box -->
                                <div class="jarviswidget-editbox">
                                    <!-- This area used as dropdown edit box -->

                                </div>
                                <!-- end widget edit box -->

                                <!-- widget content -->
                                <div class="widget-body">

                                    <form id="smart-form-register" class="smart-form">
                                        <ng-view></ng-view>
                                    </form>

                                </div>
                                <!-- end widget content -->

                            </div>
                            <!-- end widget div -->

                        </div>
                        <!-- end widget -->
                    </article>

                </div>
                <script type="text/ng-template" id="/modulo.html">
                    <section>
                        <div class="widget-body no-padding">
                            <form name="form1" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'">
                                <header>
                                    <%= translate.string_info %>
                                </header>
                                <div class="row" style="padding: 20px;">
                                    <section class="col-sm-6 col-md-6 col-lg-6">
                                        <fieldset>
                                            <section>
                                                <label class="label"><%= translate.battery_voltage %></label>
                                                <label class="select">
                                            <select name="multipleSelect" id="multipleSelect"  ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" ng-model="modulos[0].tensao_nominal" >
                                                <option value="2v">2v</option>
                                                <option value="12v">12v</option>
                                            </select>
                                            <i></i>
                                        </label>
                                            </section>
                                            <section>
                                                <label class="label"><%= translate.battery_capacity %></label>
                                                <label class="input">
										<input type="number" name="capBateria" placeholder="<%= translate.battery_capacity %>" ng-model="modulos[0].capacidade_nominal" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" required>
										<b class="tooltip tooltip-bottom-right"><%= translate.battery_capacity %></b> </label>
                                            </section>
                                            <section>
                                                <label class="label"><%= translate.nb_strings %></label>
                                                <label class="input">
										<input type="number" name="qtdStrings" id="qtdStrings" placeholder="<%= translate.nb_strings %>" ng-model="modulos[0].n_strings"  ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" required>
										<b class="tooltip tooltip-bottom-right"><%= translate.nb_strings %></b> </label>
                                            </section>
                                            <section>
                                                <label class="label"><%= translate.nb_batteries_strings %></label>
                                                <label class="input">
										<input type="number" name="qtdBatPorStrings" placeholder="<%= translate.nb_batteries_strings %>"  ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" ng-model="modulos[0].n_baterias_por_strings" required>
										<b class="tooltip tooltip-bottom-right"><%= translate.nb_batteries_strings %></b> </label>
                                            </section>            
                                            <section>                                                
                                            <label class="checkbox">
                                            <input type="checkbox" id="enablingcurrent" autocomplete='off' onchange="HabilitaCorrente();" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" <% if (checkcurrent == true) { %> checked='checked' <% } %>>
                                            <i></i><%= translate.enable_current %>

                                        </fieldset>
                                    </section>
                                    <section class="col-sm-6 col-md-6 col-lg-6">
                                        <fieldset>
                                            <section>
                                                <label class="label"><%= translate.manufacture_accumulator %></label>
                                                <label class="input">
										<input type="text" name="accMan" placeholder="<%= translate.manufacture_accumulator %>"  ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" ng-model="modulos[0].fabricante" required>
										<b class="tooltip tooltip-bottom-right"><%= translate.manufacture_accumulator %></b> </label>
                                            </section>
                                            <section>
                                                <label class="label"><%= translate.accumulator_type %></label>
                                                <label class="input">
										<input type="text" name="accType" placeholder="<%= translate.accumulator_type %>"  ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" ng-model="modulos[0].tipo" required>
										<b class="tooltip tooltip-bottom-right"><%= translate.accumulator_type %></b> </label>
                                            </section>
                                            <section>
                                                <label class="label"><%= translate.accumulator_location %></label>
                                                <label class="input">
										<input type="text" name="accLocation" placeholder="<%= translate.accumulator_location %>"  ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" ng-model="modulos[0].localizacao" required>
										<b class="tooltip tooltip-bottom-right"><%= translate.accumulator_location %></b> </label>
                                            </section>
                                            <section>
                                                <label class="label"><%= translate.installation_date %></label>
                                                <label class="input"><i class="icon-append fa fa-calendar"></i>
										<input type="text" name="dataInstalacao" id="dataInstalacao" placeholder="<%= translate.installation_date %>" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" ng-model="modulos[0].data_instalacao" required>
										<b class="tooltip tooltip-bottom-right"><%= translate.installation_date %></b> </label>
                                            </section>
                                            
                                            <section>
                                                <label class="label"><%= translate.nb_batt_horizontal_bar %></label>
                                                <label class="input">
                                        <input id="batt_hr" type="text" name="qtdBatPorStrings" placeholder="<%= translate.nb_batt_horizontal_bar %>g"  ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" ng-model="modulos[0].baterias_por_hr" required>
                                        <b class="tooltip tooltip-bottom-right"><%= translate.nb_batt_horizontal_bar %></b> </label>
                                            </section>
                                        </fieldset>
                                    </section>
                                    <button id="btnGravarDb" class="btn btn-primary" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" ng-click="saveModulo();"
                                        style="float: right; width:100px; height:30px;"><%= translate.apply %></button>
                                    <button id="btnStringRotulos" class="btn btn-primary" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" onclick="abrirModalRotulosStrings();"
                                        style="float: right; width:150px; height:30px; margin-right:10px;"><%= translate.string_labels %></button>
                                </div>
                            </form>
                            <form name="form2">
                                <header>
                                    <%= translate.config_module_alarm %>
                                </header>
                                <div class="row" style="padding: 20px;">
                                    <section class="col-sm-6 col-md-6 col-lg-6">
                                        <fieldset>
                                            <section>
                                                <label class="label"><%= translate.module_type %></label>
                                                <label class="select">
                                            <select name="multipleSelect" id="multipleSelect" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" ng-model="alarmes[0].tipo_modulo" >
                                                <option value="2">2</option>
                                                <option value="12">12</option>
                                            </select>
                                            <i></i>
                                        </label>
                                            </section>
                                            <section>
                                                <label class="label"><%= translate.alert_levels %></label>
                                                <label for="x"><input type="checkbox" id="x" ng-model="alarmes[0].alarme_pre_enabled" ng-click="onPreSelectionChanged();"/> <span><%= translate.enable_prealarm %></span></label>
                                                <table class="table table-striped table-bordered table-hover">
                                                    <thead>
                                                        <tr>
                                                            <td></td>
                                                            <td align="center"><%= translate.min %></td>
                                                            <td align="center" ng-class="{displayNone: alarmes[0].alarme_pre_enabled == 0}"><%= translate.premin %></td>
                                                            <td align="center" ng-class="{displayNone: alarmes[0].alarme_pre_enabled == 0}"><%= translate.premax %></td>
                                                            <td align="center"><%= translate.max %></td>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td><%= translate.voltage %>:</td>
                                                            <!-- Min -->
                                                            <td>
                                                                <label class="input">
                                                                    <input type="text" name="alarme_tensMin" id="alarme_tensMin" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.voltage_min %>" ng-model="alarmes[0].alarme_nivel_tensao_min">
                                                                    <b class="tooltip tooltip-bottom-right"><%= translate.voltage_min %></b> 
                                                                </label>
                                                            </td>
                                                            <!-- Pre Min -->
                                                            <td ng-class="{displayNone: alarmes[0].alarme_pre_enabled == 0}">
                                                                <label class="input">
                                                                    <input type="text" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.voltage_premin %>" ng-model="alarmes[0].alarme_nivel_tens_pre" name="alarme_tensPre" id="alarme_tensPre">
                                                                    <b class="tooltip tooltip-bottom-right"><%= translate.voltage_premin %></b>
                                                                </label>
                                                            </td>
                                                            <!-- Pre Max -->
                                                            <td ng-class="{displayNone: alarmes[0].alarme_pre_enabled == 0}">
                                                                <label class="input">
                                                                    <input type="text" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.voltage_premax %>" ng-model="alarmes[0].alarme_nivel_tens_pre_max" name="alarme_tensPreMax" id="alarme_tensPreMax">
                                                                    <b class="tooltip tooltip-bottom-right"><%= translate.voltage_premax %></b>
                                                                </label>
                                                            </td>
                                                            <!-- Max -->
                                                            <td>
                                                                <label class="input">
                                                                    <input type="text" name="alarme_tensMax" id="alarme_tensMax" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.voltage_max %>" ng-model="alarmes[0].alarme_nivel_tensao_max">
                                                                    <b class="tooltip tooltip-bottom-right"><%= translate.voltage_max %></b>
                                                                </label>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td><%= translate.temperature %>:</td>
                                                            <!-- Min -->
                                                            <td>
                                                                <label class="input">
                                                            <input type="text" name="alarme_tempMin" id="alarme_tempMin" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.temperature_min %>" ng-model="alarmes[0].alarme_nivel_temp_min">
                                                            <b class="tooltip tooltip-bottom-right"><%= translate.temperature_min %></b> 
                                                        </label>
                                                            </td>
                                                            <!-- Pre Min -->
                                                            <td ng-class="{displayNone: alarmes[0].alarme_pre_enabled == 0}">
                                                                <label class="input">
                                                                    <input type="text" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.temperature_premin %>" ng-model="alarmes[0].alarme_nivel_temp_pre" name="alarme_tempPre" id="alarme_tempPre">
                                                                    <b class="tooltip tooltip-bottom-right"><%= translate.temperature_premin %></b>
                                                                </label>
                                                            </td>
                                                            <!-- Pre Max -->
                                                            <td ng-class="{displayNone: alarmes[0].alarme_pre_enabled == 0}">
                                                                <label class="input">
                                                                    <input type="text" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.temperature_premax %>" ng-model="alarmes[0].alarme_nivel_temp_pre_max" name="alarme_tempPreMax" id="alarme_tempPreMax">
                                                                    <b class="tooltip tooltip-bottom-right"><%= translate.temperature_premax %></b>
                                                                </label>
                                                            </td>
                                                            <!-- Max -->
                                                            <td>
                                                                <label class="input">
                                                            <input type="text" name="alarme_tempMax" id="alarme_tempMax" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.temperature_max %>" ng-model="alarmes[0].alarme_nivel_temp_max">
                                                            <b class="tooltip tooltip-bottom-right"><%= translate.temperature_max %></b> 
                                                        </label>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td><%= translate.impedance %>:</td>
                                                            <!-- Min -->
                                                            <td>
                                                                <label class="input">
                                                            <input type="text" name="alarme_impMin" id="alarme_impMin" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.impedance_min %>" ng-model="alarmes[0].alarme_nivel_imped_min">
                                                            <b class="tooltip tooltip-bottom-right"><%= translate.impedance_min %></b> 
                                                        </label>
                                                            </td>
                                                            <!-- Pre Min -->
                                                            <td ng-class="{displayNone: alarmes[0].alarme_pre_enabled == 0}">
                                                                <label class="input">
                                                                    <input type="text" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.impedance_premin %>" ng-model="alarmes[0].alarme_nivel_imped_pre" name="alarme_impPre" id="alarme_impPre">
                                                                    <b class="tooltip tooltip-bottom-right"><%= translate.impedance_premin %></b>
                                                                </label>
                                                            </td>
                                                            <!-- Pre Max -->
                                                            <td ng-class="{displayNone: alarmes[0].alarme_pre_enabled == 0}">
                                                                <label class="input">
                                                                    <input type="text" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.impedance_premax %>" ng-model="alarmes[0].alarme_nivel_imped_pre_max" name="alarme_impPreMax" id="alarme_impPreMax">
                                                                    <b class="tooltip tooltip-bottom-right"><%= translate.impedance_premax %></b>
                                                                </label>
                                                            </td>
                                                            <!-- Max -->
                                                            <td>
                                                                <label class="input">
                                                            <input type="text" name="alarme_impMax" id="alarme_impMax" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.impedance_max %>" ng-model="alarmes[0].alarme_nivel_imped_max" >
                                                            <b class="tooltip tooltip-bottom-right"><%= translate.impedance_max %></b> 
                                                        </label>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td><%= translate.bus_voltage %>:</td>
                                                            <td>
                                                                <label class="input">
                                                            <input type="text" name="alarme_tensaoBarrMin" id="alarme_tensaoBarrMin" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.bus_voltage_min %>" ng-model="alarmes[0].alarme_nivel_tensao_barr_min">
                                                            <b class="tooltip tooltip-bottom-right"><%= translate.bus_voltage_min %></b> 
                                                        </label>
                                                            </td>
                                                            <td ng-class="{displayNone: alarmes[0].alarme_pre_enabled == 0}"></td>
                                                            <td ng-class="{displayNone: alarmes[0].alarme_pre_enabled == 0}"></td>
                                                            <td>
                                                                <label class="input">
                                                            <input type="text" name="alarme_tensaoBarrMax" id="alarme_tensaoBarrMax" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.bus_voltage_max %>" ng-model="alarmes[0].alarme_nivel_tensao_barr_max">
                                                            <b class="tooltip tooltip-bottom-right"><%= translate.bus_voltage_max %></b> 
                                                        </label>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td><%= translate.target %>:</td>
                                                            <td>
                                                                <label class="input">
                                                            <input type="text" name="alarme_targetMin" id="alarme_targetMin" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.target_min %>" ng-model="alarmes[0].alarme_nivel_target_min">
                                                            <b class="tooltip tooltip-bottom-right"><%= translate.target_min %></b> 
                                                        </label>
                                                            </td>
                                                            <td ng-class="{displayNone: alarmes[0].alarme_pre_enabled == 0}"></td>
                                                            <td ng-class="{displayNone: alarmes[0].alarme_pre_enabled == 0}"></td>
                                                            <td>
                                                                <label class="input">
                                                            <input type="text" name="alarme_targetMax" id="alarme_targetMax" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" placeholder="<%= translate.target_max %>" ng-model="alarmes[0].alarme_nivel_target_max">
                                                            <b class="tooltip tooltip-bottom-right"><%= translate.target_max %></b> 
                                                        </label>
                                                            </td>
                                                    
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </section>
                                            <div style="width:350px;">
                                                <label><%= translate.voltage_decimals %></label>
                                                <label class="select">
                                                        <select id="ddlCasasDecimaisHeader" onchange="alterarCasasDecimaisGlobal();" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'">
                                                            <option value="2" <%if (headerInfoCDec == 2) {%> selected<%}%>>2</option>
                                                            <option value="3" <%if (headerInfoCDec == 3) {%> selected<%}%>>3</option>
                                                        </select>
                                                        <i></i>
                                                    </label>
                                                </label>
                                                <br />
                                                <section>
                                                    <label class="checkbox">
                                                    <input type="checkbox" id="chkDesligarEqualizacao" onchange="zerarDutyMax();" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" <% if (lastDutyMax != 0) { %> checked='checked' <% } %>>
                                                    <i></i><%= translate.shutdown_equalization %>
                                                </label>
                                                </section>
                                            </div>
                                        </fieldset>
                                    </section>
                                </div>
                                <div class="row"><button id="btnGravarDb" class="btn btn-primary pull-right" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'"
                                        ng-click="saveAlarmeConfig();" style="margin-right:20px; margin-bottom:10px; width:100px; height:30px;"><%= translate.apply %></button></div>
                                <footer>
                                    <button id="btnResetarPadroes" class="btn btn-primary" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" ng-click="resetarPadroes();"><%= translate.restore_defaults %></button>
                                    <button id="btnShowHideHeaderInfo" class="btn btn-primary" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" ng-click="showHideHeaderInfo();"><%= translate.hide_target %></button>
                                    <button id="btnClearDbData" class="btn btn-primary" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" onclick="clearDbData();"><%= translate.clear_db %></button>
                                    <button id="btnClearLog" style="display:none" class="btn btn-primary" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" onclick="clearLog();" visible="false"><%= translate.clear_log %></button>
                                    <button id="btnDownloadDB" class="btn btn-primary" ng-disabled="acessoUsuario != 'administrador' && acessoUsuario != 'local'" onclick="downloadDB();"><%= translate.download_db %></button>
                                </footer>
                            </form>
                        </div>
                    </section>
                    </fieldset>

                </script>
                <script>
                    angular.module('app', ['ngRoute', 'ngResource'])
                        //---------------
                        // Services
                        //---------------
                        .factory('Modulos', ['$resource', function ($resource) {
                            return $resource('/modulo/:id', null, {
                                'update': { method: 'PUT' },
                                'remove': { method: 'DELETE' }
                            });
                        }])
                        .factory('AlarmesConfig', ['$resource', function ($resource) {
                            return $resource('/alarmeConfig/:id', null, {
                                'update': { method: 'PUT' },
                                'remove': { method: 'DELETE' }
                            });
                        }])
                        //---------------
                        // Controllers
                        //---------------
                        .controller('ModuloController', ['$scope', 'Modulos', 'AlarmesConfig', function ($scope, Modulos, AlarmesConfig) {
                            $scope.enablePreAlarme = true;
                            $scope.alarmes = AlarmesConfig.query();
                            $scope.modulos = Modulos.query();
                            console.log($scope.alarmes);
                            $scope.saveModulo = function () {
                                var modulo = $scope.modulos[0];
                                var value = modulo.baterias_por_hr;
                                var ok = 0;
                                msg = "";
                                if(value === "Ilimitado" || value == "ilimitado"){
                                    ok = 1;
                                }else if(!isNaN(value) && value > 0){
                                    if(modulo.n_baterias_por_strings % value === 0){
                                        ok = 2;
                                    }else{
                                        msg = "<%= translate.err1 %>";
                                    }
                                }else{
                                    value == "";
                                    msg = "<%= translate.err2 %>";
                                }
                                modulo.baterias_por_hr = value.toString();
                                if(ok != 0){

                                    Modulos.update(modulo);
                                    
                                    $.bigBox({
                                        title: "<%= translate.out_title_ok %>",
                                        content: "<%= translate.out_msg_ok %>",
                                        color: "#275B89",
                                        timeout: 5000,
                                        icon: "fa fa-check fadeInLeft animated"
                                    });
                                }else{
                                    $.bigBox({
                                        title: "<%= translate.out_title_nok %>",
                                        content: msg,
                                        color: "#FF6666",
                                        timeout: 10000,
                                        icon: "fa fa-times fadeInLeft animated"
                                    });
                                }
                            }

                            $scope.isOK = function(min, pre, max, premax){
                                var mmin = parseFloat(min);
                                var mpre = parseFloat(pre);
                                var mmax = parseFloat(max);
                                var pmax = parseFloat(premax);
                                return (mmin <= mpre && mpre <= mmax && mpre <= premax && premax <= mmax);
                            }

                            $scope.saveAlarmeConfig = function () {
                                var min = $scope.alarmes[0].alarme_nivel_tensao_min;
                                var pre = $scope.alarmes[0].alarme_nivel_tens_pre;
                                var premax = $scope.alarmes[0].alarme_nivel_tens_pre_max;
                                var max = $scope.alarmes[0].alarme_nivel_tensao_max;
                                var isTensOk = $scope.isOK(min, pre, max, premax);
                                var isOk = isTensOk;
                                min = $scope.alarmes[0].alarme_nivel_imped_min;
                                pre = $scope.alarmes[0].alarme_nivel_imped_pre;
                                premax = $scope.alarmes[0].alarme_nivel_imped_pre_max;
                                max = $scope.alarmes[0].alarme_nivel_imped_max;

                                var isImpedOk = $scope.isOK(min, pre, max, premax);
                                isOk &= isImpedOk;

                                min = $scope.alarmes[0].alarme_nivel_temp_min;
                                pre = $scope.alarmes[0].alarme_nivel_temp_pre;
                                premax = $scope.alarmes[0].alarme_nivel_temp_pre_max;
                                max = $scope.alarmes[0].alarme_nivel_temp_max;

                                var isTempOk = $scope.isOK(min, pre, max, premax);
                                isOk &= isTempOk;

                                if(isOk){
                                    var alarmeConfig = $scope.alarmes[0];
                                    AlarmesConfig.update(alarmeConfig);
                                    $.bigBox({
                                        title: "<%= translate.config_module_alarm %>",
                                        content: "<%= translate.out_msg_ok %>",
                                        color: "#275B89",
                                        timeout: 5000,
                                        icon: "fa fa-check fadeInLeft animated"
                                    });
                                }else{
                                    var message = "<%= translate.config %> ";
                                    if(!isTensOk){
                                        message += "<%= translate.invalid_voltage %>";
                                    }else if(!isTempOk){
                                        message += "<%= translate.invalid_temperature %>";
                                    }else if(!isImpedOk){
                                        message += "<%= translate.invalid_impedance %>";
                                    }else{
                                        message += "<%= translate.invalid %>";
                                    }
                                    $.bigBox({
                                        title: "<%= translate.config_module_alarm %>",
                                        content: message,
                                        color: "#FF6666",
                                        timeout: 5000,
                                        icon: "fa fa-check fadeInLeft animated"
                                    }); 
                                }
                            }
                            $scope.onPreSelectionChanged = function(){
                                // $scope.enablePreAlarme = $scope.alarmes[0].alarme_pre_enabled == 0;
                            };
                            $scope.resetarPadroes = function () {
                                // Tensao
                                $("#alarme_tensPreMax").val("13.200");
                                $scope.alarmes[0].alarme_nivel_tens_pre_max = "14.000";
                                $("#alarme_tensMin").val("10.500");
                                $scope.alarmes[0].alarme_nivel_tensao_min = "9.600";
                                $("#alarme_tensPre").val("12.000");
                                $scope.alarmes[0].alarme_nivel_tens_pre = "10.500";
                                $("#alarme_tensMax").val("13.500");
                                $scope.alarmes[0].alarme_nivel_tensao_max = "14.400";
                                // Temperatura
                                $("#alarme_tempPreMax").val("40.0");
                                $scope.alarmes[0].alarme_nivel_temp_pre_max = "25.0";
                                $("#alarme_tempMin").val("-10.0");
                                $scope.alarmes[0].alarme_nivel_temp_min = "0.1";
                                $("#alarme_tempPre").val("30.0");
                                $scope.alarmes[0].alarme_nivel_temp_pre = "0.5";
                                $("#alarme_tempMax").val("50.0");
                                $scope.alarmes[0].alarme_nivel_temp_max = "30.0";
                                // Impedancia
                                $("#alarme_impMin").val("1.0");
                                $scope.alarmes[0].alarme_nivel_imped_min = "0.1";
                                $("#alarme_impPreMax").val("80");
                                $scope.alarmes[0].alarme_nivel_imped_pre_max = "25.0";
                                $("#alarme_impPre").val("70.0");
                                $scope.alarmes[0].alarme_nivel_imped_pre = "0.5";
                                $("#alarme_impMax").val("100.0");
                                $scope.alarmes[0].alarme_nivel_imped_max = "30.0";
                            }
                            $scope.showHideHeaderInfo = function () {
                                if ($("#divInfoHeader").is(":visible"))
                                    $("#divInfoHeader").hide();
                                else {
                                    $("#divInfoHeader").show();
                                }
                                $.get("/moduloview/showHideHeaderInfo/", null, function (data, status) {

                                });
                            }
                            
                            $scope.nomeUsuario = '<%= username %>';
                            $scope.acessoUsuario = '<%= userAccess %>';
                            $scope.emailUsuario = '<%= userEmail %>';
                        }])
                        //---------------
                        // Routes
                        //---------------
                        .config(['$routeProvider', function ($routeProvider) {
                            $routeProvider
                                .when('/', {
                                    templateUrl: '/modulo.html',
                                    controller: 'ModuloController'
                                })
                        }]);
                </script>

            </div>
            <!-- END MAIN CONTENT -->

        </div>
        <div class="modal fade" id="modalRotulosString" tabindex="-1" role="dialog" aria-labelledby="modalRotulosString" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
									&times;
								</button>
                        <h4 class="modal-title" id="modalRotulosString"><%= translate.string_labels %></h4>
                    </div>
                    <div class="modal-body">

                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="ddlString"> <%= translate.string %></label>
                                    <select class="form-control" id="ddlString" onchange="getRotuloValue();">
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="tags"> <%= translate.label %></label>
                                    <input type="text" maxlength="9" class="form-control" id="txtRotuloString" placeholder=" <%= translate.label %>" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">
                            <%= translate.cancel %>
								</button>
                        <button type="button" class="btn btn-primary" onclick="saveRotuloString();">
                            <%= translate.save %>
								</button>

                    </div>
                    <label style="font-size: 8pt;">&nbsp&nbsp<%= translate.obs %></label>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
        <script>
            $(document).ready(function () {
                $('#dataInstalacao').datepicker({
                    dateFormat: 'dd/mm/yy',
                    prevText: '<i class="fa fa-chevron-left"></i>',
                    nextText: '<i class="fa fa-chevron-right"></i>'
                });
                $("#alerta_tensMin").maskMoney({ decimal: ".", thousands: "", precision: 3 });
                $("#alerta_tensMax").maskMoney({ decimal: ".", thousands: "", precision: 3 });
                $("#alerta_tempMin").maskMoney({ decimal: ".", thousands: "", precision: 1 });
                $("#alerta_tempMax").maskMoney({ decimal: ".", thousands: "", precision: 1 });
                $("#alerta_impMin").maskMoney({ decimal: ".", thousands: "", precision: 1 });
                $("#alerta_impMax").maskMoney({ decimal: ".", thousands: "", precision: 1 });
                // Alarmes tensao                
                $("#alarme_tensMin").maskMoney({ decimal: ".", thousands: "", precision: 3 });
                $("#alarme_tensPre").maskMoney({ decimal: ".", thousands: "", precision: 3 });
                $("#alarme_tensPreMax").maskMoney({ decimal: ".", thousands: "", precision: 3 });
                $("#alarme_tensMax").maskMoney({ decimal: ".", thousands: "", precision: 3 });
                // Alarmes Temperatura
                $("#alarme_tempMin").maskMoney({ allowNegative: true, decimal: ".", thousands: "", precision: 1 });
                $("#alarme_tempPre").maskMoney({ allowNegative: true, decimal: ".", thousands: "", precision: 1 });
                $("#alarme_tempPreMax").maskMoney({ allowNegative: true, decimal: ".", thousands: "", precision: 1 });
                $("#alarme_tempMax").maskMoney({ allowNegative: true, decimal: ".", thousands: "", precision: 1 });
                // Alarmes Impedancia
                $("#alarme_impMin").maskMoney({ decimal: ".", thousands: "", precision: 1 });
                $("#alarme_impPre").maskMoney({ decimal: ".", thousands: "", precision: 1 });
                $("#alarme_impPreMax").maskMoney({ decimal: ".", thousands: "", precision: 1 });
                $("#alarme_impMax").maskMoney({ decimal: ".", thousands: "", precision: 1 });

                $("#alarme_tensaoBarrMin").maskMoney({ decimal: ".", thousands: "", precision: 3 });
                $("#alarme_tensaoBarrMax").maskMoney({ decimal: ".", thousands: "", precision: 3 });

                $("#alarme_targetMin").maskMoney({ decimal: ".", thousands: "", precision: 3 });
                $("#alarme_targetMax").maskMoney({ decimal: ".", thousands: "", precision: 3 });

                $('#alarme_tensMin').on('change', function () {
                    if ($(this).val() > 16000 || $(this).val() < 0) {
                        $.bigBox({
                            title: "<%= translate.voltage %>",
                            content: "<%= translate.voltage_interval %>",
                            color: "#e70000",
                            timeout: 5000,
                            icon: "fa fa-check fadeInLeft animated"
                        });
                        $(this).focus();
                        $(this).val("0.000");
                    }
                });
                $('#alarme_tensMax').on('change', function () {
                    if ($(this).val() > 16000 || $(this).val() < 0) {
                        $.bigBox({
                            title: "<%= translate.voltage %>",
                            content: "<%= translate.voltage_interval %>",
                            color: "#e70000",
                            timeout: 5000,
                            icon: "fa fa-check fadeInLeft animated"
                        });
                        $(this).focus();
                        $(this).val("0.000");
                    }
                });

                $('#alarme_tempMin').on('change', function () {
                    if ($(this).val() > 200 || $(this).val() < -100) {
                        $.bigBox({
                            title: "<%= translate.temperature %>",
                            content: "<%= translate.temperature_interval %>",
                            color: "#e70000",
                            timeout: 5000,
                            icon: "fa fa-check fadeInLeft animated"
                        });
                        $(this).focus();
                        $(this).val("0.000");
                    }
                });
                $('#alarme_tempMax').on('change', function () {
                    if ($(this).val() > 200 || $(this).val() < -100) {
                        $.bigBox({
                            title: "<%= translate.temperature %>",
                            content: "<%= translate.temperature_interval %>",
                            color: "#e70000",
                            timeout: 5000,
                            icon: "fa fa-check fadeInLeft animated"
                        });
                        $(this).focus();
                        $(this).val("0.000");
                    }
                });

                $('#alarme_impMin').on('change', function () {
                    if ($(this).val() > 1000 || $(this).val() < 0) {
                        $.bigBox({
                            title: "<%= translate.impedance %>",
                            content: "<%= translate.impedance_interval %>",
                            color: "#e70000",
                            timeout: 5000,
                            icon: "fa fa-check fadeInLeft animated"
                        });
                        $(this).focus();
                        $(this).val("0.000");
                    }
                });
                $('#alarme_impMax').on('change', function () {
                    if ($(this).val() > 1000 || $(this).val() < 0) {
                        $.bigBox({
                            title: "<%= translate.impedance %>",
                            content: "<%= translate.impedance_interval %>",
                            color: "#e70000",
                            timeout: 5000,
                            icon: "fa fa-check fadeInLeft animated"
                        });
                        $(this).focus();
                        $(this).val("0.000");
                    }
                });
            });
            function resetarPadroes() {

            }
            function clearDbData() {
                $.SmartMessageBox({
                    title: "<%= translate.db_clear_confirm_title %>",
                    content: "<%= translate.db_clear_confirm_msg %>",
                    buttons: '[<%= translate.no %>][<%= translate.yes %>]'
                }, function (ButtonPressed) {
                    if (ButtonPressed === "<%= translate.yes %>") {
                        $.get("/moduloview/clearDb/", null, function (data, status) {
                        });
                        $.smallBox({
                            title: "<%= translate.db_clear_confirm_title %>",
                            content: "<i class='fa fa-clock-o'></i> <i><%= translate.db_clear_ok %></i>",
                            color: "#659265",
                            iconSmall: "fa fa-check fa-2x fadeInRight animated",
                            timeout: 4000
                        });
                    }
                });
            }
            function clearLog() {
                $.SmartMessageBox({
                    title: "<%= translate.clear_log %>",
                    content: "<%= translate.clear_log_msg %>",
                    buttons: '[<%= translate.no %>][<%= translate.yes %>]'
                }, function (ButtonPressed) {
                    if (ButtonPressed === "<%= translate.yes %>") {
                        $.get("/moduloview/clearLog/", null, function (data, status) {
                        });
                        $.smallBox({
                            title: "Apagar log",
                            content: "<i class='fa fa-clock-o'></i> <i><%= translate.db_clear_ok %></i>",
                            color: "#659265",
                            iconSmall: "fa fa-check fa-2x fadeInRight animated",
                            timeout: 4000
                        });
                    }
                });
            }
            function downloadDB() {
                $.SmartMessageBox({
                    title: "<%= translate.db_download_title %>",
                    content: "<%= translate.db_download_msg %>",
                    buttons: '[<%= translate.no %>][<%= translate.yes %>]'
                }, function (ButtonPressed) {
                    if (ButtonPressed === "<%= translate.yes %>") {
                        window.location.href = '/moduloview/downloadDB/';
                    }
                });
            }
            function abrirModalRotulosStrings() {
                var numeroStrings = parseInt($("#qtdStrings").val());
                $("#txtRotuloString").val("");
                for (var i = 1; i <= numeroStrings; i++) {
                    $('#ddlString').append($('<option>', {
                        value: i,
                        text: 'S' + i.toString()
                    }));
                }
                getRotuloValue();
                $('#modalRotulosString').modal('show');
            }
            function getRotuloValue() {
                $("#txtRotuloString").val("");
                var parametros = { string: $("#ddlString option:selected").text(), apelido: $("#txtRotuloString").val() };
                $.get("/moduloview/rotuloString/" + $("#ddlString option:selected").text(), null, function (data) {
                    $("#txtRotuloString").val(data);
                });
            }
            function saveRotuloString() {
                if ($("#ddlString option:selected").text().trim() == "" || $("#txtRotuloString").val().trim() == "") {
                    alert("String ou Rótulo não preenchidos.");
                    return;
                }
                var parametros = { string: $("#ddlString option:selected").text(), apelido: $("#txtRotuloString").val() };
                $.post("/moduloview/gravarRotuloString/", parametros, function (data) {
                    $.bigBox({
                        title: "<%= translate.string_label %>",
                        content: data,
                        color: "#659265",
                        timeout: 1000,
                        icon: "fa fa-check fadeInLeft animated"
                    });
                });
            }
            function alterarCasasDecimaisGlobal() {
                $.get("/moduloview/changeCasasDecHeader/" + $("#ddlCasasDecimaisHeader").val(), null, function (data) {
                    $.bigBox({
                        title: "<%= translate.decimals %>",
                        content: data,
                        color: "#659265",
                        timeout: 1000,
                        icon: "fa fa-check fadeInLeft animated"
                    });
                    setTimeout(function () { location.reload() }, 1000);
                });
            }
            function zerarDutyMax() {
                if ($("#chkDesligarEqualizacao").is(":checked")) {
                    $.get("/moduloview/zerarDutyMax", null, function (data) {
                        $.bigBox({
                            title: "<%= translate.equalization %>",
                            content: data,
                            color: "#659265",
                            timeout: 1000,
                            icon: "fa fa-check fadeInLeft animated"
                        });
                    });
                }else{
                    $.get("/moduloview/voltarDutyMax", null, function (data) {
                        $.bigBox({
                            title: "<%= translate.equalization %>",
                            content: data,
                            color: "#659265",
                            timeout: 1000,
                            icon: "fa fa-check fadeInLeft animated"
                        });
                    });
                }
            }
            function HabilitaCorrente() {
                if ($("#enablingcurrent").is(":checked")) {
                    $.post("/moduloview/Read/HabilitaCorrente", null, function (data) {
                        $.bigBox({
                            title: "<%= translate.enable_current %>",
                            content: data,
                            color: "#659265",
                            timeout: 1000,
                            icon: "fa fa-check fadeInLeft animated"
                        });
                    });
                }else{
                    $.post("/moduloview/Read/ReabilitaCorrente", null, function (data) {
                        $.bigBox({
                            title: "<%= translate.enable_current %>",
                            content: data,
                            color: "#659265",
                            timeout: 1000,
                            icon: "fa fa-check fadeInLeft animated"
                        });
                    });
                }
            }
        </script>
        <% include partials/footer %>
</body>

</html>
